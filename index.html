<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur d'Inclinaison Solaire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style pour les inputs */
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: invert(0.5) sepia(0.6) saturate(2) hue-rotate(180deg);
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #2563eb; /* blue-600 */
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
        input[type=range]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #2563eb;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
        }
        .switch-field {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-lg bg-white rounded-2xl shadow-lg p-6 md:p-8 space-y-6 relative">

            <!-- Bouton d'aide principal -->
            <button id="main-help-button" class="absolute top-4 right-4 p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>

            <!-- En-tête et Localisation -->
            <div class="text-center border-b pb-6">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Calculateur d'Inclinaison Solaire</h1>
                <div class="mt-4 max-w-xs mx-auto">
                    <label for="latitude-input" class="block text-sm font-medium text-gray-700 mb-1">Localisation de l'installation</label>
                    <div class="flex items-center gap-2">
                        <input type="number" id="latitude-input" step="any" placeholder="ex: 44.21" class="block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <button id="get-location" title="Utiliser ma position actuelle" class="p-2 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                     <p id="location-subtitle" class="text-sm text-gray-500 mt-2 h-4"></p>
                    <p id="location-error" class="text-xs text-red-500 h-4 mt-1"></p>
                </div>
            </div>

            <!-- Calcul & Mesure -->
            <div class="bg-gray-50 border border-gray-200 rounded-xl p-6 grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                <!-- Angle Cible -->
                <div class="text-center">
                    <label for="date-input" class="block text-md font-medium text-blue-800 mb-2">Date Cible</label>
                    <input type="date" id="date-input" class="w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <p class="mt-4 text-lg text-blue-900">Angle Recommandé</p>
                    <p id="result" class="text-5xl md:text-6xl font-bold text-blue-600 my-1">--°</p>
                </div>
                <!-- Angle Mesuré -->
                <div class="text-center md:border-l md:pl-6 border-gray-200">
                     <p class="text-lg text-gray-700">Angle Actuel</p>
                     <p class="text-5xl md:text-6xl font-bold text-gray-800 my-1"><span id="current-angle">--</span>°</p>
                     <button id="start-sensors" class="mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm">Activer les capteurs</button>
                     <p id="inclinometer-error" class="text-xs text-red-500 h-4 mt-1"></p>
                </div>
            </div>


            <!-- Réglages avancés -->
            <div>
                 <h2 class="text-xl font-bold text-center text-gray-800 mb-4">Réglages Avancés</h2>
                 <div class="bg-gray-50 p-4 rounded-lg border">
                    <!-- Azimut & Boussole -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                        <!-- Cible Azimut -->
                        <div class="text-center">
                             <label for="azimuth-slider" class="block text-sm font-medium text-gray-700">Déviation Cible / Sud</label>
                             <input type="range" id="azimuth-slider" min="-90" max="90" value="0" step="1" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer mt-2">
                             <div class="flex justify-between text-xs text-gray-500 px-1 mt-1">
                                 <span>90° Est</span>
                                 <span id="azimuth-value" class="font-bold text-base text-gray-800">0° Sud</span>
                                 <span>90° Ouest</span>
                             </div>
                        </div>
                        <!-- Mesure Boussole -->
                        <div class="text-center md:border-l md:pl-6 border-gray-200">
                            <p class="text-lg text-gray-700">Orientation Mesurée</p>
                            <p class="text-2xl font-bold text-gray-800 my-1"><span id="current-compass">--</span></p>
                            <p id="compass-error" class="text-xs text-red-500 h-4 mt-1">Activez les capteurs</p>
                        </div>
                    </div>
                    <p class="text-center text-xs text-gray-500 pt-3 border-t mt-4">Pour un calcul précis, ajustez la réglette ci-dessus pour qu'elle corresponde à votre orientation mesurée.</p>
                 </div>
            </div>

            <!-- Recommandations saisonnières -->
            <div>
                <h2 class="text-xl font-bold text-center text-gray-800 mb-4">Réglages Saisonniers & Dates de Changement</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                    <div class="bg-gray-100 rounded-lg p-4">
                        <p class="font-bold text-lg">Hiver</p>
                        <p id="winter-angle" class="text-3xl font-bold text-sky-600">60°</p>
                        <p class="text-xs text-gray-500">Changer le ~21 Déc.</p>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-4">
                        <p class="font-bold text-lg">Mi-saison</p>
                        <p id="spring-fall-angle" class="text-3xl font-bold text-amber-600">44°</p>
                        <p class="text-xs text-gray-500">~20 Mars & ~22 Sep.</p>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-4">
                        <p class="font-bold text-lg">Été</p>
                        <p id="summer-angle" class="text-3xl font-bold text-red-600">29°</p>
                        <p class="text-xs text-gray-500">Changer le ~21 Juin</p>
                    </div>
                </div>
            </div>

            <!-- Section Optimisation Écrêtage -->
            <div class="bg-gray-50 p-4 rounded-lg border">
                <div class="flex items-center justify-center">
                    <input type="checkbox" id="clipping-checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <label for="clipping-checkbox" class="ml-2 block text-sm font-medium text-gray-700">Optimiser pour éviter l'écrêtage</label>
                    <button id="clipping-help-button" class="ml-2 p-1 rounded-full bg-gray-200 hover:bg-gray-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Section Don -->
            <div class="text-center pt-4">
                <a href="#" id="donate-link" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>
                    Soutenir ce projet (Faire un don)
                </a>
            </div>

            <!-- Copyright -->
            <div class="text-center text-xs text-gray-500 pt-4 border-t mt-6">
                <p>- By FredZ - 2025</p>
            </div>

        </div>
    </div>

    <!-- Modal d'aide Écrêtage -->
    <div id="clipping-help-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Qu'est-ce que l'optimisation pour l'écrêtage ?</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500 text-left">
                        Si vos panneaux solaires sont plus puissants que votre micro-onduleur (ex: panneau de 500W sur un onduleur de 400W), l'onduleur peut "écrêter" : il bride la production à son maximum, et vous perdez l'énergie excédentaire au milieu de la journée.
                        <br><br>
                        En cochant cette case, l'application vous recommandera un angle d'inclinaison **volontairement plus élevé** durant les mois à forte production (Avril à Septembre).
                        <br><br>
                        Cela permet de **réduire le pic de production à midi** (que vous perdez de toute façon) pour **améliorer la production le matin et le soir**. Le bilan total sur la journée est ainsi meilleur.
                    </p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-clipping-modal" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300">
                        Compris
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Guide d'utilisation -->
     <div id="main-help-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-xl leading-6 font-medium text-gray-900 text-center">Guide d'utilisation</h3>
                
                <!-- Schéma visuel -->
                <div class="mt-4 flex justify-around items-center text-center text-xs text-gray-600 p-4 bg-gray-50 rounded-lg">
                    <div class="flex flex-col items-center space-y-1">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">1</div>
                        <p>Localisation</p>
                    </div>
                    <span class="text-gray-400">&rarr;</span>
                    <div class="flex flex-col items-center space-y-1">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">2</div>
                        <p>Date</p>
                    </div>
                    <span class="text-gray-400">&rarr;</span>
                    <div class="flex flex-col items-center space-y-1">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">3</div>
                        <p>Orientation</p>
                    </div>
                     <span class="text-gray-400">&rarr;</span>
                    <div class="flex flex-col items-center space-y-1">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600">✓</div>
                        <p>Réglage</p>
                    </div>
                </div>

                <div class="mt-4 px-2 py-3 space-y-3">
                    <p class="text-sm text-gray-600">
                        <strong class="text-gray-800">1. Localisation :</strong> Saisissez votre latitude manuellement ou utilisez le bouton GPS <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg> pour une détection automatique.
                    </p>
                     <p class="text-sm text-gray-600">
                        <strong class="text-gray-800">2. Date Cible :</strong> Choisissez le jour pour lequel vous souhaitez connaître l'inclinaison optimale.
                    </p>
                    <p class="text-sm text-gray-600">
                        <strong class="text-gray-800">3. Angle Recommandé :</strong> L'application calcule l'angle d'inclinaison idéal pour cette date et cette localisation.
                    </p>
                    <p class="text-sm text-gray-600">
                        <strong class="text-gray-800">4. Mesure & Réglage :</strong> Activez les capteurs.
                        <ul class="list-disc list-inside ml-4 mt-1 text-xs">
                            <li>Posez le grand côté de votre téléphone sur le panneau pour mesurer son <strong class="text-gray-700">Angle Actuel</strong>.</li>
                            <li>Posez le téléphone à plat sur le panneau pour mesurer son <strong class="text-gray-700">Orientation Mesurée</strong>.</li>
                        </ul>
                    </p>
                     <p class="text-sm text-gray-600">
                        <strong class="text-gray-800">5. Affiner le calcul :</strong> Dans les "Réglages Avancés", ajustez la réglette "Déviation Cible" pour qu'elle corresponde à votre orientation mesurée. Cela garantit la meilleure précision pour l'angle recommandé.
                    </p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-main-modal" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300">
                        Fermer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Éléments du DOM ---
        const dateInput = document.getElementById('date-input');
        const resultDisplay = document.getElementById('result');
        const latitudeInput = document.getElementById('latitude-input');
        const locationSubtitle = document.getElementById('location-subtitle');
        const azimuthSlider = document.getElementById('azimuth-slider');
        const azimuthValueDisplay = document.getElementById('azimuth-value');
        const clippingCheckbox = document.getElementById('clipping-checkbox');
        const winterAngleDisplay = document.getElementById('winter-angle');
        const springFallAngleDisplay = document.getElementById('spring-fall-angle');
        const summerAngleDisplay = document.getElementById('summer-angle');
        const startSensorsButton = document.getElementById('start-sensors');
        const currentAngleDisplay = document.getElementById('current-angle');
        const inclinometerError = document.getElementById('inclinometer-error');
        const currentCompassDisplay = document.getElementById('current-compass');
        const compassError = document.getElementById('compass-error');
        const donateLink = document.getElementById('donate-link');
        const getLocationButton = document.getElementById('get-location');
        const locationError = document.getElementById('location-error');
        const clippingHelpButton = document.getElementById('clipping-help-button');
        const clippingHelpModal = document.getElementById('clipping-help-modal');
        const closeClippingModalButton = document.getElementById('close-clipping-modal');
        const mainHelpButton = document.getElementById('main-help-button');
        const mainHelpModal = document.getElementById('main-help-modal');
        const closeMainModalButton = document.getElementById('close-main-modal');


        // --- Configuration ---
        donateLink.href = 'https://paypal.me/iFredZ'; 

        // --- Constantes ---
        const defaultLatitude = 44.21446183336044;
        const clippingAdjustment = 10; 

        // --- Fonctions utilitaires ---
        const toRadians = (angle) => angle * (Math.PI / 180);

        const getDayOfYear = (date) => {
            const startOfYear = new Date(date.getFullYear(), 0, 0);
            const diff = date - startOfYear;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        };

        const calculateDeclination = (dayOfYear) => {
            return -23.45 * Math.cos(toRadians((360 / 365) * (dayOfYear + 10)));
        };

        function updateAzimuthDisplay(azimuth) {
            if (azimuth === 0) {
                azimuthValueDisplay.textContent = '0° Sud';
            } else if (azimuth === -90) {
                azimuthValueDisplay.textContent = 'Plein Est';
            } else if (azimuth === 90) {
                azimuthValueDisplay.textContent = 'Plein Ouest';
            } else if (azimuth < 0) {
                azimuthValueDisplay.textContent = `${Math.abs(azimuth)}° Est`;
            } else {
                azimuthValueDisplay.textContent = `${azimuth}° Ouest`;
            }
        }

        function calculateAndDisplayAll() {
            const selectedDateStr = dateInput.value;
            if (!selectedDateStr) {
                resultDisplay.textContent = '--°';
                return;
            }
            const selectedDate = new Date(selectedDateStr);
            if (isNaN(selectedDate.getTime())) {
                resultDisplay.textContent = '--°';
                return;
            }

            let currentLatitude = parseFloat(latitudeInput.value) || defaultLatitude;
            locationSubtitle.textContent = latitudeInput.value.trim() ? `Localisation personnalisée : Lat ${currentLatitude.toFixed(2)}` : '';

            const panelAzimuth = parseInt(azimuthSlider.value);
            updateAzimuthDisplay(panelAzimuth);
            const cosAzimuth = Math.cos(toRadians(panelAzimuth));

            const month = selectedDate.getMonth();
            let dailyAdjustment = (clippingCheckbox.checked && month >= 3 && month <= 8) ? clippingAdjustment : 0;
            
            const dayOfYear = getDayOfYear(selectedDate);
            const declination = calculateDeclination(dayOfYear);
            let optimalTiltSouth = currentLatitude - declination + dailyAdjustment;
            resultDisplay.textContent = `${Math.round(optimalTiltSouth / cosAzimuth)}°`;

            const seasonalClippingAdjustment = clippingCheckbox.checked ? clippingAdjustment : 0;
            const winterAngleSouth = currentLatitude + 15;
            const summerAngleSouth = currentLatitude - 15;
            const springFallAngleSouth = currentLatitude;
            
            winterAngleDisplay.textContent = `${Math.round(winterAngleSouth / cosAzimuth)}°`;
            summerAngleDisplay.textContent = `${Math.round((summerAngleSouth + seasonalClippingAdjustment) / cosAzimuth)}°`;
            springFallAngleDisplay.textContent = `${Math.round(springFallAngleSouth / cosAzimuth)}°`;
        }
        
        // --- Logique des capteurs ---
        function handleOrientation(event) {
            // Inclinomètre (beta)
            if (event.beta !== null) {
                let tilt = Math.round(event.beta);
                if (tilt < 0) tilt = 0;
                if (tilt > 90) tilt = 90;
                currentAngleDisplay.textContent = tilt;
            } else {
                inclinometerError.textContent = "Inclinomètre non dispo.";
            }

            // Boussole (alpha)
            const heading = event.webkitCompassHeading || event.alpha;
            if (heading !== null && heading !== undefined) {
                compassError.textContent = "";
                
                const correctedHeading = 360 - heading;

                let deviation = correctedHeading - 180;
                if (deviation <= -180) deviation += 360;
                if (deviation > 180) deviation -= 360;

                if (Math.abs(deviation) < 10) {
                    currentCompassDisplay.textContent = 'Plein Sud';
                } else if (Math.abs(deviation - 90) < 10) {
                    currentCompassDisplay.textContent = 'Plein Ouest';
                } else if (Math.abs(deviation + 90) < 10) {
                    currentCompassDisplay.textContent = 'Plein Est';
                } else if (Math.abs(deviation) > 170) {
                    currentCompassDisplay.textContent = 'Plein Nord';
                }
                else {
                    const direction = deviation > 0 ? 'Ouest' : 'Est';
                    currentCompassDisplay.textContent = `${Math.round(Math.abs(deviation))}° ${direction}`;
                }
            } else {
                compassError.textContent = "Boussole non dispo.";
            }
        }

        function startSensors() {
            inclinometerError.textContent = "";
            compassError.textContent = "Activation...";
            
            const startListening = () => {
                const eventName = 'ondeviceorientationabsolute' in window ? 'deviceorientationabsolute' : 'deviceorientation';
                window.addEventListener(eventName, handleOrientation, true);
                startSensorsButton.textContent = "Capteurs activés";
                startSensorsButton.disabled = true;
                startSensorsButton.classList.add('bg-gray-400', 'cursor-not-allowed');
            };

            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            startListening();
                        } else {
                            inclinometerError.textContent = "Permission refusée.";
                            compassError.textContent = "";
                        }
                    })
                    .catch(error => {
                        inclinometerError.textContent = "Erreur capteur.";
                        console.error(error);
                    });
            } else if ('DeviceOrientationEvent' in window) {
                startListening();
            } else {
                 inclinometerError.textContent = "Capteurs non supportés.";
                 compassError.textContent = "";
            }
        }

        // --- Logique de Géolocalisation ---
        function getLocation() {
            locationError.textContent = "Obtention de la position...";
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        latitudeInput.value = lat.toFixed(4);
                        calculateAndDisplayAll();
                        locationError.textContent = "";
                    },
                    () => {
                        locationError.textContent = "Impossible d'obtenir la position.";
                    }
                );
            } else {
                locationError.textContent = "Géolocalisation non supportée.";
            }
        }

        // --- Logique des Modals ---
        function toggleClippingModal() {
            clippingHelpModal.classList.toggle('hidden');
        }
         function toggleMainHelpModal() {
            mainHelpModal.classList.toggle('hidden');
        }

        // --- Écouteurs d'événements ---
        dateInput.addEventListener('change', calculateAndDisplayAll);
        latitudeInput.addEventListener('input', calculateAndDisplayAll);
        azimuthSlider.addEventListener('input', calculateAndDisplayAll);
        clippingCheckbox.addEventListener('change', calculateAndDisplayAll);
        startSensorsButton.addEventListener('click', startSensors);
        getLocationButton.addEventListener('click', getLocation);
        clippingHelpButton.addEventListener('click', toggleClippingModal);
        closeClippingModalButton.addEventListener('click', toggleClippingModal);
        mainHelpButton.addEventListener('click', toggleMainHelpModal);
        closeMainModalButton.addEventListener('click', toggleMainHelpModal);
        
        clippingHelpModal.addEventListener('click', (e) => { if (e.target === clippingHelpModal) { toggleClippingModal(); } });
        mainHelpModal.addEventListener('click', (e) => { if (e.target === mainHelpModal) { toggleMainHelpModal(); } });


        // --- Initialisation au chargement de la page ---
        window.addEventListener('load', () => {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            
            dateInput.value = `${year}-${month}-${day}`;
            calculateAndDisplayAll();
        });
    </script>
</body>
</html>
