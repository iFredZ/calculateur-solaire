:root {
    --bg: #0b1220;
    --card: #121a2b;
    --muted: #7b8aa5;
    --fg: #e9f0ff;
    --accent: #41d1b7;
    --accent-blue: #437eff;
    --warn: #ffcc00;
    --bad: #ff6b6b;
    --btn-secondary-bg: #2a3957;
    --input-bg: #0e1423;
    --border-color: rgba(255, 255, 255, .06);
    --border-color-input: rgba(255,255,255,.1);
    --info-box-bg: rgba(123, 138, 165, 0.1);
}
.light-mode {
    --bg: #f1f5f9;
    --card: #ffffff;
    --muted: #475569;
    --fg: #0f172a;
    --accent-blue: #1d4ed8;
    --btn-secondary-bg: #e2e8f0;
    --input-bg: #f8fafc;
    --border-color: #e2e8f0;
    --border-color-input: #cbd5e1;
    --info-box-bg: #f1f5f9;
}
body {
    font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif;
    background-color: var(--bg);
    color: var(--fg);
    -webkit-tap-highlight-color: transparent;
}
.card {
    background-color: var(--card);
    border: 1px solid var(--border-color);
}
.header-title {
    font-family: 'Exo 2', sans-serif;
    font-size: 1.75rem;
    color: var(--fg);
    letter-spacing: 0.05em;
    text-shadow: 0 0 5px rgba(255,255,255,0.1), 0 0 15px var(--accent), 0 0 25px var(--accent);
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis;
}
.btn-primary { background-color: var(--accent); color: #00110e; }
.btn-primary:hover { background-color: #52d9c3; }
.btn-secondary { background-color: var(--btn-secondary-bg); color: var(--fg); }
.light-mode .btn-secondary { color: #1f2937; }
.btn-secondary:hover { background-color: #3a4a6a; }
.light-mode .btn-secondary:hover { background-color: #d1d5db; }
.btn-danger { background-color: var(--bad); color: #fff; }
.btn-danger:hover { background-color: #ff8a8a; }

.bg-accent-blue { background-color: var(--accent-blue); }

input, .bg-input {
    background-color: var(--input-bg);
    border: 1px solid var(--border-color-input);
    color: var(--fg);
}
input::placeholder { color: var(--muted); }

.icon-btn {
    background-color: var(--card);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease-in-out;
    border: 1px solid var(--border-color);
}
.icon-btn:hover {
    transform: scale(1.1);
    background-color: var(--btn-secondary-bg);
}
.loader {
    border: 4px solid var(--btn-secondary-bg);
    border-radius: 50%;
    border-top: 4px solid var(--accent);
    width: 24px;
    height: 24px;
    animation: spin 2s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.cockpit-display {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    background: radial-gradient(circle at 50% 50%, transparent 60%, rgba(65, 209, 183, 0.05) 90%);
    border: 2px solid var(--border-color);
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 40px rgba(65, 209, 183, 0.05) inset, 0 5px 15px rgba(0,0,0,0.2);
}

#memorize-ring-btn {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    color: var(--fg);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    position: relative;
    z-index: 10;
    font-size: 1.25rem;
    overflow: hidden;
}
#memorize-ring-btn:not(:disabled):active { transform: scale(0.95); }
#memorize-ring-btn:disabled {
    background-color: var(--input-bg);
    border-color: var(--muted);
    opacity: 0.5;
    box-shadow: none;
    animation: none;
}
.compass-rose, .inclinometer-line { transition: transform 0.2s ease-out; }
.info-box { background-color: var(--info-box-bg); }

main { flex: 1 0 auto; }

.lang-btn {
    background-color: var(--card);
    color: var(--muted);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 0.8rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-color);
}
.lang-btn:hover {
    transform: scale(1.1);
    background-color: var(--btn-secondary-bg);
    color: var(--fg);
}
.lang-btn.active {
    background-color: var(--accent);
    color: #00110e;
    border-color: var(--accent);
}
.theme-switch-wrapper { display: flex; align-items: center; gap: 0.5rem; }
.theme-switch { display: inline-block; height: 24px; position: relative; width: 48px; }
.theme-switch input { display: none; }
.slider { background-color: #374151; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 24px; }
.slider:before { background-color: #fff; bottom: 4px; content: ""; height: 16px; left: 4px; position: absolute; transition: .4s; width: 16px; border-radius: 50%; }
input:checked + .slider { background-color: var(--accent); }
input:checked + .slider:before { transform: translateX(24px); }

.onboarding-dot.active { background-color: var(--accent); transform: scale(1.5); }
#onboarding-modal { animation: fadeIn 0.3s ease-in-out; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

@keyframes pulse-glow {
    0%, 100% { box-shadow: 0 0 10px rgba(65, 209, 183, 0.2), 0 0 20px rgba(65, 209, 183, 0.2); }
    50% { box-shadow: 0 0 20px rgba(65, 209, 183, 0.5), 0 0 40px rgba(65, 209, 183, 0.5); }
}
.btn-style-default {
    background: var(--btn-secondary-bg);
    border: 2px solid var(--border-color);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    animation: pulse-glow 2.5s ease-in-out infinite;
}
#memorize-btn-wrapper.stable .btn-style-default {
    animation: none;
    border-color: var(--accent);
    box-shadow: 0 0 25px var(--accent), 0 0 50px rgba(65, 209, 183, 0.5);
}
/* FIX: Style Néon corrigé pour être indépendant */
.btn-style-neon {
    background: radial-gradient(circle at 50% 50%, rgba(65,209,183,.15), transparent 70%), linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.2));
    border: 2px solid rgba(65,209,183,.5);
    box-shadow: 0 0 0 2px rgba(65,209,183,.12) inset, 0 10px 25px rgba(0,0,0,.35);
    animation: pulse-glow 2.2s ease-in-out infinite;
}
.btn-style-neon::before {
    content:""; position:absolute; inset:-2px; border-radius:50%;
    background: conic-gradient(from 0deg, transparent, rgba(65,209,183,.35), transparent 60%);
    animation: neonSweep 2.2s linear infinite;
}
#memorize-btn-wrapper.stable .btn-style-neon {
    animation: none; border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(65,209,183,.18) inset, 0 12px 30px rgba(0,0,0,.35), 0 0 60px rgba(65,209,183,.55);
}
#memorize-btn-wrapper.stable .btn-style-neon::before { display: none; }
@keyframes neonSweep { to { transform: rotate(360deg); } }

.btn-style-glass {
    background: linear-gradient(180deg, rgba(255,255,255,.15), rgba(255,255,255,.02));
    border: 1px solid rgba(255,255,255,.18);
    box-shadow: 0 1px 0 rgba(255,255,255,.2) inset, 0 -8px 18px rgba(0,0,0,.45) inset, 0 10px 25px rgba(0,0,0,.35);
    backdrop-filter: blur(6px);
}
.btn-style-glass::before {
    content:""; position:absolute; inset:8px; border-radius:50%;
    background: radial-gradient(60px 60px at 35% 30%, rgba(255,255,255,.5), transparent 60%);
}
.btn-style-glass::after {
    content:""; position:absolute; inset: 15%; border-radius:50%;
    background: radial-gradient(circle, var(--accent), transparent 60%);
    opacity: 0.5; filter: blur(20px); animation: pulse-core 3s ease-in-out infinite;
}
@keyframes pulse-core {
    0%, 100% { transform: scale(0.8); opacity: 0.3; }
    50% { transform: scale(1.1); opacity: 0.6; }
}
#memorize-btn-wrapper.stable .btn-style-glass {
    border-color: rgba(65,209,183,.7);
    box-shadow: 0 1px 0 rgba(255,255,255,.25) inset, 0 -10px 24px rgba(65,209,183,.16) inset, 0 0 50px rgba(65,209,183,.45);
}
#memorize-btn-wrapper.stable .btn-style-glass::after { animation: none; transform: scale(1.2); opacity: 1; }

.btn-style-radar {
    background: radial-gradient(circle at 50% 50%, transparent 95%, var(--accent) 96%), repeating-conic-gradient(from 0deg, transparent 0% 29.5deg, rgba(16,185,129,.15) 30%), repeating-radial-gradient(circle at 50% 50%, rgba(16,185,129,.15), rgba(16,185,129,.15) 1px, transparent 1px, transparent 20%);
    border: 2px solid rgba(16,185,129,.45);
    box-shadow: 0 0 15px rgba(16,185,129,.2) inset;
}
.btn-style-radar::before {
    content:""; position:absolute; inset:0; border-radius:50%;
    background: conic-gradient(from 0deg, transparent 0deg, rgba(16,185,129,.4) 35deg, transparent 70deg);
    animation: radarSpin 2.4s linear infinite;
}
#memorize-btn-wrapper.stable .btn-style-radar {
    background-color: rgba(16,185,129,.2); border-color: var(--accent);
    box-shadow: 0 0 30px var(--accent) inset, 0 0 50px var(--accent);
}
#memorize-btn-wrapper.stable .btn-style-radar::before { animation-play-state: paused; opacity: 0.2; }
@keyframes radarSpin { to { transform: rotate(360deg); } }

.light-mode .text-gray-400 { color: var(--muted); }
.light-mode .text-teal-300 { color: var(--accent-blue); }
.light-mode .text-teal-400 { color: var(--accent); }
.light-mode #production-results .text-green-300 { color: #065f46; }
.light-mode #production-results .text-blue-300 { color: #1e40af; }
.light-mode #production-results .font-bold { color: var(--fg); }
.light-mode #production-results .text-amber-300 { color: #b45309; }

/* --- STYLES POUR LES BOUTONS ROTATIFS --- */
.knob {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, var(--bg), var(--card));
    border: 3px solid var(--border-color);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3), inset 0 3px 5px rgba(0,0,0,0.4);
    position: relative;
    cursor: pointer;
    transition: transform 0.2s ease;
}

.knob:active {
    transform: scale(0.95);
}

.knob-indicator {
    width: 4px;
    height: 20px;
    background-color: var(--accent);
    border-radius: 2px;
    position: absolute;
    left: 50%;
    top: 10px;
    transform-origin: 2px 30px; /* Centre de rotation: moitié de la largeur, distance du centre du knob */
    transform: translateX(-50%);
    transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1); /* Animation fluide */
    box-shadow: 0 0 8px var(--accent);
}

/* === Photon Grid Splash (overlay fixe, pas de changement de layout) === */
.splash-pg{position:fixed;inset:0;z-index:9999;background:#05070d;
  display:grid;place-items:center;
  background-image:
    radial-gradient(ellipse at top left, rgba(34,211,238,0.08), transparent 45%),
    radial-gradient(ellipse at bottom right, rgba(245,158,11,0.06), transparent 55%);
  transition:opacity .6s ease;opacity:1;pointer-events:auto;
}
.splash-pg.pg-hide{opacity:0;pointer-events:none}
.splash-pg .pg-wrap{display:flex;flex-direction:column;align-items:center;gap:18px}
.splash-pg .pg-logo{position:relative;width:120px;height:120px;border-radius:50%;
  display:grid;place-items:center;color:#e6f4ff;text-transform:uppercase;letter-spacing:.08em;
  text-shadow:0 0 10px rgba(245,158,11,0.55),0 0 18px rgba(34,211,238,0.35);
}
.splash-pg .pg-title{font-weight:700;font-size:14px;opacity:.9}
.splash-pg .pg-orbit{position:absolute;inset:-10px;border-radius:50%;
  border:1px dashed rgba(245,158,11,0.45);box-shadow:0 0 14px rgba(245,158,11,0.18);
  animation:pgOrbit 14s linear infinite;
}
@keyframes pgOrbit{to{transform:rotate(360deg)}}
.splash-pg .pg-flare{position:absolute;width:8px;height:8px;border-radius:50%;
  background:#22d3ee;box-shadow:0 0 18px rgba(34,211,238,0.85), 0 0 36px rgba(34,211,238,0.45);
  animation:pgFlare 2.2s ease-in-out infinite;
}
@keyframes pgFlare{0%{transform:translate(-48px,-32px)}50%{transform:translate(46px,24px)}100%{transform:translate(-48px,-32px)}}
/* cadran */
.splash-pg .pg-dial{--track:rgba(34,211,238,.18);--glow:rgba(245,158,11,.25);
  width:180px;height:180px;border-radius:50%;
  background:radial-gradient(circle at 50% 50%, rgba(245,158,11,0.07), transparent 60%),
             conic-gradient(from -90deg, var(--track) 0 360deg);
  border:1px solid rgba(34,211,238,0.35);
  box-shadow:inset 0 0 22px rgba(34,211,238,0.25),0 0 30px var(--glow);
  position:relative;
}
.splash-pg .pg-needle{position:absolute;left:50%;top:50%;width:2px;height:42%;
  background:#f59e0b;transform-origin:50% 100%;
  transform:translate(-50%,-100%) rotate(-90deg);
  box-shadow:0 0 18px rgba(245,158,11,.35);
  transition:transform .6s cubic-bezier(.2,.8,.3,1.2);
}
.splash-pg .pg-center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);color:#e6f4ff;font-weight:600}
/* CTA */
.splash-pg .pg-cta{background:linear-gradient(180deg,#f59e0b,#fbbf24);color:#0a0f1a;
  border:none;border-radius:999px;padding:10px 18px;font-weight:700;box-shadow:0 6px 18px rgba(245,158,11,.35)
}
.splash-pg .pg-cta:active{transform:translateY(1px)}
.splash-pg .pg-tip{color:#7a8ca5;font-size:12px}
/* Indication visuelle du bouton Mémoriser (dans l'écran principal) */
.pg-pulse{animation:pgPulse 1.3s ease-in-out 3}
@keyframes pgPulse{0%,100%{box-shadow:0 0 0 0 rgba(245,158,11,.0)}50%{box-shadow:0 0 0 12px rgba(245,158,11,.25)}}


/* === New splash visuals: globe + solar scene === */
.splash-pg .pg-globe{
  width:min(70vw,320px); height: min(35vw,160px);
  border-radius:14px; position:relative; overflow:hidden;
  background: radial-gradient(120% 100% at 10% 0%, rgba(34,211,238,0.1), transparent 60%),
              linear-gradient(180deg, #07121f, #0b1526);
  border:1px solid rgba(34,211,238,0.35);
  box-shadow: inset 0 0 22px rgba(34,211,238,0.18), 0 0 30px rgba(245,158,11,0.18);
  transform: scale(.92);
}
.splash-pg .pg-grid{
  position:absolute; inset:0;
  background:
    repeating-linear-gradient(90deg, rgba(255,255,255,.05) 0 1px, transparent 1px 24px),
    repeating-linear-gradient(0deg, rgba(255,255,255,.05) 0 1px, transparent 1px 24px);
  mask-image: radial-gradient(120% 200% at 50% 50%, #000 65%, transparent 100%);
}
.splash-pg .pg-location{
  --x:50%; --y:50%;
  position:absolute; width:10px;height:10px;border-radius:50%;
  left: calc(var(--x)); top: calc(var(--y));
  transform: translate(-50%,-50%);
  background:#22d3ee; box-shadow: 0 0 16px rgba(34,211,238,.9), 0 0 36px rgba(34,211,238,.5);
  animation: pgPing 1.8s ease-out infinite;
}
@keyframes pgPing{0%{transform:translate(-50%,-50%) scale(.8)}70%{transform:translate(-50%,-50%) scale(1.2)}100%{transform:translate(-50%,-50%) scale(.8)}}
.splash-pg.pg-zoom .pg-globe{animation: pgZoom 2s ease forwards}
@keyframes pgZoom{0%{transform:scale(.88)}100%{transform:scale(1)}}

/* Solar panel scene */
.splash-pg .pg-scene{position:relative;width:min(76vw,340px);height:min(42vw,180px);}
.splash-pg .pg-sky{position:absolute;inset:0;border-radius:14px 14px 0 0;
  background: linear-gradient(180deg,#0b1b2e,#0a1220 60%, transparent 60%);
  overflow:hidden;
}
.splash-pg .pg-sun{position:absolute;left:-10%;top:18%;
  width:22px;height:22px;border-radius:50%;background:#fbbf24;
  box-shadow:0 0 24px rgba(245,158,11,.8),0 0 46px rgba(245,158,11,.45);
  animation: sunPath 5.2s linear infinite;
}
@keyframes sunPath{
  0%{transform:translateX(0) translateY(0)}
  50%{transform:translateX(60vw) translateY(-4px)}
  100%{transform:translateX(120vw) translateY(0)}
}
.splash-pg .pg-panel{
  position:absolute; left:8%; right:8%; bottom:10%; height:34%;
  background: linear-gradient(180deg,#0e223a,#0b1627);
  border-radius:10px; border:1px solid rgba(34,211,238,.3);
  box-shadow: inset 0 0 18px rgba(34,211,238,.2), 0 10px 30px rgba(0,0,0,.35);
  transform: perspective(500px) rotateX(16deg);
  overflow:hidden;
}
.splash-pg .pg-panel-grid{position:absolute;inset:8px;background:
  repeating-linear-gradient(90deg, rgba(34,211,238,.15) 0 1px, transparent 1px 36px),
  repeating-linear-gradient(0deg, rgba(34,211,238,.15) 0 1px, transparent 1px 36px);
}
.splash-pg .pg-sheen{position:absolute;inset:-20%;background:
  linear-gradient(60deg, rgba(255,255,255,.0) 0%, rgba(255,255,255,.15) 45%, rgba(255,255,255,.0) 60%);
  animation: sheenMove 4.6s ease-in-out infinite;
}
@keyframes sheenMove{0%{transform:translateX(-60%)}50%{transform:translateX(60%)}100%{transform:translateX(160%)}}



/* === Splash Overlay (covers app) v3 === */
.splash-overlay{position:fixed; inset:0; z-index:2147483647; background:#000; color:var(--fg, #eaf1ff); --gold:#ffd56a; --titleY:34vh;}
/* hide any legacy splash underneath */
#pg-splash, .pg-splash, #pg-zoom, .pg-zoom{display:none !important;}
.splash-overlay.exit{opacity:0; transition:opacity .38s ease; pointer-events:none;}
.splash-overlay .topHalo,
.splash-overlay .sky,
.splash-overlay .hud,
.splash-overlay .titleWrap,
.splash-overlay .cta{position:absolute;}
.splash-overlay .topHalo{inset:0;}
.splash-overlay .sky{inset:0;}
.splash-overlay .hud{left:50%; bottom:3vh; transform:translateX(-50%); width:min(94vmin,980px); text-align:center; pointer-events:none;}
.splash-overlay .titleWrap{left:0; right:0; top: var(--titleY); transform:translateY(-50%); display:grid; place-items:center;}
.splash-overlay .titleSvg{width:min(84vw, 1000px); height:auto;}
.splash-overlay .cta{left:50%; transform:translateX(-50%); bottom:22px; text-align:center; z-index:2;}
.splash-overlay .splash-btn{border:1px solid rgba(255,255,255,.18);color:var(--fg, #eaf1ff);background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(0,0,0,.25));padding:10px 14px;border-radius:12px;cursor:pointer;backdrop-filter:blur(6px);transition:transform .15s ease,border-color .2s ease,background .2s ease;font-weight:600;opacity:0;transform:translateY(6px)}
.splash-overlay .splash-btn.show{opacity:1; transform:none; transition:opacity .4s ease, transform .4s ease;}
.splash-overlay .splash-btn:hover{transform:translateY(-1px);border-color:rgba(255,213,106,.5)}
/* HUD visuals */
.splash-overlay .curve{fill:none;stroke:#23d3ee;stroke-width:2;filter:drop-shadow(0 0 8px rgba(35,211,238,.35))}
.splash-overlay .curve-p{stroke:#ffd56a;filter:drop-shadow(0 0 8px rgba(255,213,106,.35))}
.splash-overlay .grid{stroke:rgba(255,255,255,.15);stroke-width:1}
.splash-overlay .axis{stroke:rgba(255,255,255,.28);stroke-width:1.4}
.splash-overlay .label{fill:rgba(255,255,255,.6);font: 12px/1.2 system-ui, sans-serif}
.splash-overlay .stars{opacity:.32;animation:twinkle 6s ease-in-out infinite;
  background-image:
    radial-gradient(1px 1px at 12% 28%,rgba(255,255,255,.9) 50%,transparent 51%),
    radial-gradient(1px 1px at 72% 14%,rgba(255,255,255,.6) 50%,transparent 51%),
    radial-gradient(1px 1px at 25% 70%,rgba(255,255,255,.7) 50%,transparent 51%),
    radial-gradient(1px 1px at 88% 80%,rgba(255,255,255,.55) 50%,transparent 51%);
  background-size: 420px 420px; background-repeat:repeat;
}
.splash-overlay .particles{position:absolute;inset:0;overflow:hidden}
.splash-overlay .spark{position:absolute;width:2px;height:2px;border-radius:50%;background:var(--gold);filter:blur(.3px);opacity:0;will-change:transform,opacity}
.splash-overlay .topHalo::before{
  content:""; position:absolute; left:50%; top:-56vmin; transform:translateX(-50%);
  width:220vmin; height:150vmin; border-radius:50%;
  background:radial-gradient(ellipse at 50% 88%,rgba(255,213,106,.55) 0%,rgba(255,184,47,.38) 28%,rgba(255,184,47,.18) 52%,rgba(255,184,47,.08) 68%,transparent 78%);
  filter: blur(18px); opacity:1;
  -webkit-mask-image: linear-gradient(to bottom, #000 0%, #000 32%, transparent 56%);
          mask-image: linear-gradient(to bottom, #000 0%, #000 32%, transparent 56%);
  animation: haloBreath 9s ease-in-out infinite alternate;
}
.splash-overlay .topHalo::after{
  content:""; position:absolute; left:50%; top:-60vmin; transform:translateX(-50%);
  width:210vmin; height:146vmin; border-radius:50%; pointer-events:none;
  background:linear-gradient(to bottom, rgba(255,213,106,.22) 0%, rgba(255,184,47,.08) 22%, transparent 46%),radial-gradient(ellipse at 50% 92%, transparent 74%, rgba(255,213,106,.85) 82%, transparent 88%);
  filter: blur(10px); opacity:.95;
  -webkit-mask-image: linear-gradient(to bottom, #000 0%, #000 26%, transparent 50%);
          mask-image: linear-gradient(to bottom, #000 0%, #000 26%, transparent 50%);
}
@keyframes twinkle{0%,100%{opacity:.22}50%{opacity:.46}}
@keyframes haloBreath{ from{ filter: blur(20px); opacity:.9 } to { filter: blur(26px); opacity:.7 } }
